---
title: '编码: url 和 base64'
date: 2019-06-09 20:04:53
tags: web
---
> 今天突然想到一个问题，为什么需要 url 编码 和 base64 编码呢？如果不做处理会有什么问题呢？

# base64 
在日常生活中文本通常是用 ASCII 表示，而 ASCII 编码的是使用 7 bit 来表示的，大多数些操作系统上则会使用字节 8bit 来存储二进制数据，这样直接使用 ASCII 就可能会出问题。

而标准 base64 共 6 位，即共有 64 个字符（英文大小写、数字和+、/），通过将 3 个 ASCII 字符转化为 4 个 base64 字符，就可以保证规避那些可能出错的 ASCII。转化后的 base64 长度必然能被 4 整除（不算等号）

显然，不是所有文本长度都是 3 的整数倍，因此，当不能被 3 整除时，就用 \0 补齐, 有几个 \0 就有几个 =。

# URL 编码
## 概述
URL 中通过 & 分隔参数，通过 = 来分隔 key 和 value，但是存在一个问题，如果 key 或者 value 中存在 & 和 = 应当如何处理呢？
答案就是通过编码保证这些值避免这些问题，这些需要编码的字符即为不安全字符。
* 空格：Url在传输的过程，或者用户在排版的过程，或者文本处理程序在处理Url的过程，都有可能引入无关紧要的空格，或者将那些有意义的空格给去掉。
* 引号以及<>：引号和尖括号通常用于在普通文本中起到分隔Url的作用
* #：通常用于表示书签或者锚点
* %：百分号本身用作对不安全字符进行编码时使用的特殊字符，因此本身需要编码
* {}|\^[]`~：某一些网关或者传输代理会篡改这些字符

Url编码默认使用的字符集是US-ASCII。例如a在US-ASCII码中对应的字节是0x61，那么Url编码之后得到的就是%61，对于非 ASCII 编码，通常使用 Unicode 的 utf-8 来进行编码。

## 细节
在 JS 中， encodeURI 和 encodeURIComponent 的安全字符是不同的，分别如下：
* encodeURI（82个）：!#$&'()*+,/:;=?@-._~0-9a-zA-Z
* encodeURIComponent（71个）：!'()*-._~0-9a-zA-Z

encodeURI 需要处理整个 URL，因此很多字符不应当处理，而 encodeURIComponent 则是指 key 或者 value。

表单提交的时候每个值都会经过 URL 编码，但是并不是最新标准。

另外，很多HTTP监视工具或者浏览器地址栏等在显示Url的时候会自动将Url进行一次解码（使用UTF-8字符集），这就是为什么当你在Firefox中访问Google搜索中文的时候，地址栏显示的Url包含中文的缘故。但实际上发送给服务端的原始Url还是经过编码的。


# 参考资料
* [为什么要进行URL编码](https://zhuanlan.zhihu.com/p/58479085)
* [为什么要使用base64编码](https://www.zhihu.com/question/36306744/answer/71626823)
* [Why do we use Base64?](https://stackoverflow.com/questions/3538021/why-do-we-use-base64)