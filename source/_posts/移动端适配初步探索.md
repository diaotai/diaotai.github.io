---
title: 移动端适配初步探索
date: 2018-12-02 16:20:48
tags:
---
# 移动端适配
> 本文档用于记录一些移动端适配探索的收获，以及使用 flexible 时碰到的问题 

## 基本概念
移动端适配会依赖一些概念，下面进行简单的介绍：

### 像素相关

#### 物理像素(physical pixel)
物理像素又称为设备像素，来表示显示设备上最微小的物理单位，每个像素都可以单独设置其颜色和亮度。

#### 设备独立像素(density-independent pixel)
设备独立像素又称为密度无关像素，它可以被理解为计算机坐标系统中的一个点，这个点可以代表一个虚拟像素，会被相关系统转化为物理像素。 不同设备的设备独立像素可能会存在区别。

#### CSS像素
CSS像素又被称为设备无关像素(device-independent pixel)，简称DIPs。
CSS像素属于抽象单位，主要用于精确度量 Web 页面上的内容。
**要注意的是，屏幕缩放操作会直接改变 1 CSS像素 所代表的 物理像素(这也是一种解决 1像素 问题的思路)**
![CSS像素缩放示意图](http://sf1-ttcdn-tos.pstatp.com/obj/ttfe/scale.png)

#### 屏幕密度
屏幕密度是指一个设备表面上存在的像素数量，它通常以每英寸有多少像素来计算(PPI)。
PS: 这个概念我在好几篇文章中都看到了，然而没看到有谁用了这个概念

#### 设备像素比(device pixel ratio)
设备像素比简称 dpr，它表示了一个 CSS像素 对应了几个 物理像素。
```
    设备像素比 = 物理像素 / CSS像素
```
在 JavaScript 中，可以使用 window.devicePixelRatio 来获取当前设备 dpr。而在CSS中，可以通过-webkit-device-pixel-ratio，-webkit-min-device-pixel-ratio和 -webkit-max-device-pixel-ratio进行媒体查询。
不过说真的，目前见到的适配方案都是在 js 层面做的，没看到在 CSS 层面做适配的方案。

![设备像素比示意图](https://camo.githubusercontent.com/a407f9dc63ca26a60ade9ed8830713c14f6132d8/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f3230313231322f726574696e612d7765622d332e6a7067)

上图属于很经典的示意图了，简单来说，就是在不同设备上 1 CSS像素 对应的 物理像素 是不同的。

### viewport 视口
对于视口概念，目前大家比较认可的解释是 ppk 大神的三种视口的解释，对此他用了三篇文章进行阐述。
1. [第一篇](https://www.quirksmode.org/mobile/viewports.html)
2. [第二篇](http://www.quirksmode.org/mobile/viewports2.html)
3. [第三篇](http://www.quirksmode.org/mobile/metaviewport/)

在本处简单介绍一下他的理解：

#### layout viewport
首先，移动设备的浏览器认为自己应该能让所有网站都正常显示，即使是那些没有做移动端适配页面。但是如果浏览器直接以可视区域作为 viewport，因为移动设备普遍较窄，所以很多页面布局会直接乱掉。所以移动端浏览器会在默认情况下给 viewport 设置一个较宽的值，这样 PC 端页面也可以正常显示了。
ppk 将这个浏览器的默认视口称为 layout viewport, 我们可以通过 document.documentElement.clientWidth 来获取其宽度。

#### visual viewport
layout viewport 的值是大过浏览器可视区域的，所以我们需要一个 viewport 来代表可视区域，即 visual viewport。visual viewport 的宽度可以通过window.innerWidth 来获取，但在Android 2, Oprea mini 和 UC 8中无法正确获取。
**要注意的是，视觉视口与设备屏幕一样宽，并且它的css像素的数量会随着用户缩放而改变。这也就导致了在可见区域内 1 CSS像素 对应的 物理像素是不同的**

#### ideal viewport
ideal viewport 即将布局视口改为设备宽度的视口，是对设备来说最理想的布局适口——即用户不需要进行任何缩放或左右滚动即可看到全部内容。
ideal viewport 没有固定的尺寸，不同的设备拥有不同的理想视口。
我们可以通过 screen.width 测量理想视口的大小。

#### 屏幕缩放时三种视口值的变化
![视口变化](http://sf1-ttcdn-tos.pstatp.com/obj/ttfe/viewport-change.png)

也就是说，当屏幕缩放时只有 visual viewport 在跟随变化，当页面缩小时 可见视口 会变大（因为代表的区域更大了），反之亦然。

### meta 标签
meta viewport 标签首先是由苹果公司在其safari浏览器中引入的，目的就是解决移动设备的viewport问题。后来安卓以及各大浏览器厂商也都纷纷效仿，引入对meta viewport的支持，事实也证明这个东西还是非常有用的。

```
<meta name="viewport" content="width=device-width">
```
本行代码是非常常见的，但是在iphone和ipad上，无论是竖屏还是横屏，宽度都是竖屏时ideal viewport的宽度。

```
<meta name="viewport" content="initial-scale=1">
```
测试结果表明 initial-scale=1 也能把当前的viewport宽度变成 ideal viewport 的宽度，但这次轮到了windows phone 上的IE 无论是竖屏还是横屏都把宽度设为竖屏时ideal viewport的宽度。
**这一行可以得到类似的效果，因为 scale 的是针对于 ideal viewport 进行缩放的，因此，当设置为 1 时就是 ideal viewport。**
*当宽度和缩放比冲突时，会以较大的那个值为准*
因此，当写以下代码时，就会解决适配问题
```
    <meta name="viewport" content="width=device-width, initial-scale=1">
```


**visual viewport宽度 = ideal viewport宽度  / 当前缩放值**
